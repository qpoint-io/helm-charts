# Default values for qscan.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

image:
  repository: us-docker.pkg.dev/qpoint-edge/public/qscan
  pullPolicy: IfNotPresent
  # Overrides the image tag whose default is the chart appVersion.
  tag: ""

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

# Number of qscan worker replicas
replicaCount: 1

serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # Automatically mount a ServiceAccount's API credentials?
  automount: true
  # Annotations to add to the service account
  annotations: {}
  # The name of the service account to use.
  # If not set and create is true, a name is generated using the fullname template
  name: ""

podAnnotations: {}
podLabels: {}

podSecurityContext: {}

securityContext:
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: false
  runAsNonRoot: true
  runAsUser: 1000
  runAsGroup: 3000
  capabilities:
    drop:
      - ALL

# Pulse API configuration
pulse:
  # Pulse service endpoint
  endpoint: "https://pulse.qpoint.io"
  # External secret reference for Pulse API key (recommended for production)
  # The secret should contain a key named "pulse-api-key"
  apiKeySecretRefName: ""
  # Inline API key (for testing only - not recommended for production)
  apiKey: ""

# AWS S3 configuration
aws:
  s3:
    bucketName: "assets"
    regionName: "us-east-1"
    endpointUrl: "https://s3.warehouse.qpoint.io"
  # External secret reference for AWS credentials (recommended for production)
  # The secret should contain keys named "AWS_ACCESS_KEY_ID" and "AWS_SECRET_ACCESS_KEY"
  credentials:
    secretRefName: ""
    # Inline credentials (for testing only - not recommended for production)
    accessKeyId: ""
    secretAccessKey: ""

# QScan worker configuration
qscan:
  # Number of async workers polling for jobs
  numPollers: 2
  # Number of ProcessPoolExecutor workers for CPU-intensive ML work
  numScanners: 2
  # Fraction of container memory limit (0.0-1.0)
  memoryLimitFraction: 0.9
  # Logging level: debug, info, warn, error, dpanic, panic, fatal
  logLevel: "info"
  # Log format: json or console
  logEncoding: "json"
  # Set to "ignore" to avoid cyclical reporting
  qpointStrategy: "ignore"

# Metrics configuration
metrics:
  enabled: true
  port: 9090

# Service for Prometheus metrics scraping
service:
  enabled: true
  type: ClusterIP
  port: 9090
  annotations: {}
    # prometheus.io/scrape: "true"
    # prometheus.io/port: "9090"
    # prometheus.io/path: "/"

# Resource requests and limits
resources:
  limits:
    cpu: 4000m
    memory: 16Gi
  requests:
    cpu: 2000m
    memory: 8Gi

# GPU support (disabled by default)
gpu:
  enabled: false
  # Number of GPUs to request
  count: 1

# Health probe configuration
startupProbe:
  enabled: true
  initialDelaySeconds: 10
  periodSeconds: 5
  timeoutSeconds: 2
  successThreshold: 1
  failureThreshold: 30

readinessProbe:
  enabled: true
  initialDelaySeconds: 5
  periodSeconds: 10
  timeoutSeconds: 2
  successThreshold: 1
  failureThreshold: 2

livenessProbe:
  enabled: true
  initialDelaySeconds: 15
  periodSeconds: 30
  timeoutSeconds: 3
  successThreshold: 1
  failureThreshold: 3

# Horizontal Pod Autoscaler (disabled by default)
autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 5
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80

# Pod Disruption Budget (disabled by default)
podDisruptionBudget:
  enabled: false
  minAvailable: 1

nodeSelector: {}

tolerations: []

affinity: {}

# Optional config.yaml for model selection and advanced configuration
config: ""
# config: |
#   global:
#     device: auto  # Options: 'auto', 'cpu', 'cuda', 'mps'
#     log_level: INFO
#
#   models:
#     piiranha:
#       enabled: true
#       model_name: iiiorg/piiranha-v1-detect-personal-information
#
#     presidio:
#       enabled: true
#       spacy_model: en_core_web_lg
#       lang_code: en
#
#     flair:
#       enabled: true
#       model_name: flair/ner-english-large

# Additional environment variables for the deployment
extraEnv: []
# extraEnv:
#   - name: SOME_ENV_VAR
#     value: "some-value"
#   - name: SOME_SECRET_VAR
#     valueFrom:
#       secretKeyRef:
#         name: some-secret
#         key: some-key
